---
import BaseLayout from '../../layouts/BaseLayout.astro';
import blogData from '../../data/blog.json';
import siteData from '../../data/site.json';
import themeData from '../../data/theme.json';

const pageTitle = `Blog | ${siteData.name}`;

// Process data to ensure sorting by date works
const posts = blogData.sort(
	(a, b) => new Date(b.pubDate).valueOf() - new Date(a.pubDate).valueOf()
);

const gridColumns = themeData.layout.grid?.blogColumns || 2;
---

<BaseLayout title={pageTitle}>
	<section class="container mt-8">
		<h1 class="mb-8">Blog</h1>
		<div class="project-grid" style={`grid-template-columns: repeat(${gridColumns}, 1fr);`}> 
			{
				posts.map((post) => (
					<a href={`/blog/${post.slug}/`} class="project-card-link">
                        <div class="project-card">
                            {post.heroImage && <img src={post.heroImage} alt={post.title} class="card-image" />}
                            <div class="project-content">
                                <h3 class="title">{post.title}</h3>
                                <div class="meta">
                                    <span class="date">
                                        {new Date(post.pubDate).toLocaleDateString('en-us', {
                                            year: 'numeric',
                                            month: 'short',
                                            day: 'numeric',
                                        })}
                                    </span>
                                </div>
                                <p class="description">{post.description}</p>
                                <div class="tags">
                                    {post.tags.map(tag => (
                                        <span class="tag">{tag}</span>
                                    ))}
                                </div>
                            </div>
                        </div>
					</a>
				))
			}
		</div>
	</section>
</BaseLayout>

<style>
  /* Page specific styles if any, most are now global */
  .intro {
    max-width: var(--max-width);
    margin-bottom: var(--space-xl);
  }
  .card-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-bottom: 1px solid var(--color-border);
  }
</style>
