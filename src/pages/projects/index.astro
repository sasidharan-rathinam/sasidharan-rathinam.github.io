---
import BaseLayout from '../../layouts/BaseLayout.astro';
import projectsData from '../../data/projects.json';
import siteData from '../../data/site.json';
import themeData from '../../data/theme.json';

const pageTitle = `Projects | ${siteData.name}`;

// Process data to ensure sorting by date works (dates are strings in JSON)
const projects = projectsData.sort(
	(a, b) => new Date(b.pubDate).valueOf() - new Date(a.pubDate).valueOf()
);

const gridColumns = themeData.layout.grid?.projectColumns || 2;
---

<BaseLayout title={pageTitle}>
	<section class="container mt-8">
		<h1 class="mb-8">Projects</h1>
		<div class="project-grid" style={`grid-template-columns: repeat(${gridColumns}, 1fr);`}>
			{
				projects.map((project) => (
					<a href={`/projects/${project.slug}/`} class="project-card-link">
                        <div class="project-card">
                            <div class="project-content">
                                <h3 class="title">{project.title}</h3>
                                <div class="meta">
                                    <span class="company">{project.company}</span>
                                    <span class="date">
                                        {new Date(project.pubDate).toLocaleDateString('en-us', {
                                            year: 'numeric',
                                            month: 'short',
                                            day: 'numeric',
                                        })}
                                    </span>
                                </div>
                                <p class="description">{project.description}</p>
                                <div class="tags">
                                    {project.tags.map(tag => (
                                        <span class="tag">{tag}</span>
                                    ))}
                                </div>
                            </div>
                        </div>
					</a>
				))
			}
            {projects.length === 0 && (
                <p class="text-muted">Projects coming soon...</p>
            )}
		</div>
	</section>
</BaseLayout>

<style>
  /* Page specific styles if any, most are now global */
  .intro {
    max-width: var(--max-width);
    margin-bottom: var(--space-lg);
  }
</style>
