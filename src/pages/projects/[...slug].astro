---
import { type CollectionEntry, getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
	const projects = await getCollection('projects');
	return projects.map((project) => ({
		params: { slug: project.slug },
		props: project,
	}));
}
type Props = CollectionEntry<'projects'>;

const project = Astro.props;
const { Content } = await project.render();

const pageTitle = `${project.data.title} | Projects`;
---

<BaseLayout title={pageTitle} description={project.data.description}>
	<article class="container mt-8">
        <div class="project-header">
            <a href="/projects" class="back-link">&larr; Back to Projects</a>
            <h1 class="title">{project.data.title}</h1>
            <div class="meta">
                {project.data.company && <span class="company">{project.data.company}</span>}
                {project.data.role && <span class="role"> | {project.data.role}</span>}
                <span class="date"> | {project.data.pubDate.toLocaleDateString('en-us', { year: 'numeric', month: 'short'})}</span>
            </div>
            {project.data.tags && (
                <div class="tags">
                    {project.data.tags.map(tag => <span class="tag">{tag}</span>)}
                </div>
            )}
        </div>
        
        <div class="prose content">
		    <Content />
        </div>
	</article>
</BaseLayout>

<style>
    .project-header {
        margin-bottom: var(--space-xl);
        border-bottom: 1px solid var(--color-border);
        padding-bottom: var(--space-lg);
    }
    .back-link {
        display: inline-block;
        margin-bottom: var(--space-md);
        font-size: 0.9rem;
        color: var(--color-text-muted);
    }
    .title {
        font-size: 2.5rem;
        margin-bottom: var(--space-sm);
    }
    .meta {
        color: var(--color-text-muted);
        margin-bottom: var(--space-md);
        font-size: 1.1rem;
    }
    .company {
        color: var(--color-accent);
        font-weight: 600;
    }
    .tags {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }
    .tag {
        background: var(--color-bg-secondary);
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.85rem;
        color: var(--color-text-main);
    }
    .content {
        max-width: var(--max-width);
        margin: 0 auto;
        font-size: 1.125rem;
    }
    /* Add basic prose styling for markdown content */
    .content :global(h2) {
        margin-top: 2.5rem;
    }
    .content :global(p) {
        margin-bottom: 1.5rem;
    }
    .content :global(ul) {
        margin-bottom: 1.5rem;
        padding-left: 1.5rem;
    }
    .content :global(li) {
        margin-bottom: 0.5rem;
    }
    .content :global(img) {
        max-width: 100%;
        border-radius: 8px;
        margin: var(--space-md) 0;
        border: 1px solid var(--color-border);
    }
</style>
